{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "description": "Stacked area chart for Body Mass Index (BMI) categories (Underweight, Healthy, Overweight/Obese) across continents and World (2000-2014) with BMI category text annotations at the end of the chart.",
  "data": {
    "url": "https://raw.githubusercontent.com/mmio0004/W10Homework/main/data/Transformed_Men_Weight_Categories_by_Continent.csv"
  },
  "params": [
    {
      "name": "SelectedContinent",
      "value": "All Continents",
      "bind": {
        "input": "select",
        "options": [
          "All Continents",
          "Asia", "Africa", "North America", "South America", "Europe", "Oceania"
        ],
        "name": "Select Continent: "
      }
    }
  ],
  "transform": [
    {
      "filter": "SelectedContinent == 'All Continents' ? true : datum.Region == SelectedContinent"
    },
    {
      "aggregate": [
        {"op": "mean", "field": "Healthy (NCDRisC (2017))", "as": "Healthy"},
        {"op": "mean", "field": "Overweight or Obese (NCDRisC (2017))", "as": "Overweight"},
        {"op": "mean", "field": "Underweight (NCDRisC (2017))", "as": "Underweight"}
      ],
      "groupby": ["Year"]
    },
    {
      "fold": [
        "Healthy",
        "Overweight",
        "Underweight"
      ],
      "as": ["BMI Category", "value"]
    }
  ],
  "layer": [
    {
      "mark": {
        "type": "area",
        "stroke": "black",
        "strokeWidth": {
          "condition": {
            "param": "select",
            "empty": false,
            "value": 3
          },
          "value": 1
        }
      },
      "selection": {
        "highlight": {
          "type": "single",
          "fields": ["BMI Category"],  
          "on": "mouseover",
          "empty": "none",
          "clear": "mouseout"
        },
        "select": {
          "type": "multi",
          "fields": ["BMI Category"], 
          "on": "click",
          "empty": "none"
        }
      },
      "encoding": {
        "x": {
          "field": "Year",
          "type": "ordinal",
          "title": "Year"
        },
        "y": {
          "field": "value",
          "type": "quantitative",
          "title": "Proportion of Males (%)",
          "stack": "normalize"
        },
        "color": {
          "field": "BMI Category",
          "type": "nominal",
          "title": "Body Mass Index (BMI) Category",
          "scale": {
            "scheme": "category10"
          }
        },
        "fillOpacity": {
          "condition": [
            {
              "param": "select",
              "empty": false,
              "value": 1
            },
            {
              "param": "highlight",
              "empty": false,
              "value": 2
            }
          ],
          "value": 0.8
        },
        "tooltip": [
          {"field": "Year", "type": "ordinal", "title": "Year"},
          {"field": "BMI Category", "type": "nominal", "title": "Body Mass Index (BMI) Category"},
          {"field": "value", "type": "quantitative", "title": "Proportion of Males (%)", "format": ".1f"}
        ]
      }
    },
    {
      "mark": {
        "type": "text",
        "align": "right",
        "baseline": "top",
        "dx": 31,
        "dy": 4, 
        "fontSize": 9,
        "fontWeight": "bold"
      },
      "transform": [
        {
          "filter": "datum.Year == 2013" 
        }
      ],
      "encoding": {
        "x": {
          "field": "Year",
          "type": "ordinal"
        },
        "y": {
          "aggregate": "mean",
          "field": "value",
          "stack": "normalize"
        },
        "text": {
          "field": "BMI Category"
        },
        "color": {
          "value": "black"
        }
      }
    }
  ],
  "width": 600,
  "height": 300
}
